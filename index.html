<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>äºŒä½æ•¸ä¹˜æ³•ç·´ç¿’ (4x5 æº¢å‡ºä¿®æ­£ç‰ˆ)</title>
    <style>
        :root {
            --cell-w: 45px; --cell-h: 50px; --font-main: 28pt; --font-sign: 22pt; --col-count: 3;
        }
        @page { size: A4; margin: 0; }
        body { font-family: "Microsoft JhengHei", sans-serif; margin: 0; padding: 0; background: #f4f4f4; }
        
        .no-print { 
            text-align: center; padding: 12px; background: #2c3e50; 
            position: sticky; top: 0; z-index: 100; display: flex; justify-content: center; flex-wrap: wrap; gap: 8px;
        }
        button { padding: 6px 12px; font-size: 13px; cursor: pointer; color: white; border: none; border-radius: 4px; transition: 0.2s; }
        .btn-mode { background: #2980b9; }
        .btn-layout { background: #34495e; border: 1px solid #7f8c8d; }
        .btn-toggle { background: #f39c12; font-weight: bold; }
        .active { background: #e74c3c !important; box-shadow: 0 0 5px #fff; }

        .a4-page {
            width: 210mm; height: 297mm; padding: 5mm 8mm; margin: 5mm auto;
            background: white; box-sizing: border-box; box-shadow: 0 0 10px rgba(0,0,0,0.1);
            overflow: hidden; display: flex; flex-direction: column;
        }

        .header { text-align: center; margin-bottom: 2px; }
        .header h1 { margin: 2px 0; font-size: 16pt; letter-spacing: 2px; }
        
        .student-info { display: flex; justify-content: center; margin-bottom: 8px; font-size: 11pt; gap: 20px; }
        .student-info .line { border-bottom: 1.5px solid #000; padding: 0 10px; min-width: 45px; display: inline-block; vertical-align: bottom; }

        .quiz-container {
            display: grid; 
            grid-template-columns: repeat(var(--col-count), 1fr); 
            gap: 4px 4px; /* ç¸®å°é–“è·é˜²æ­¢æº¢å‡º */
            flex-grow: 1;
        }

        .math-problem {
            display: flex; flex-direction: column; align-items: center; padding: 2px 0;
            border: 0.5px solid transparent;
        }

        .problem-top {
            display: grid;
            grid-template-columns: calc(var(--cell-w) * 0.7) var(--cell-w) var(--cell-w) var(--cell-w); 
            font-size: var(--font-main); font-weight: bold; text-align: center; line-height: 1.0;
        }

        .top-cell { width: var(--cell-w); height: var(--cell-h); display: flex; justify-content: center; align-items: center; }
        .top-sign { width: calc(var(--cell-w) * 0.7); height: var(--cell-h); display: flex; justify-content: center; align-items: center; font-size: var(--font-sign); }
        .underline { grid-column: 1 / 5; border-bottom: 2.5px solid black; margin-bottom: 2px; }

        .answer-grid {
            display: grid;
            grid-template-columns: repeat(3, var(--cell-w)); 
            border-top: 1.5px solid #000; border-left: 1.5px solid #000;
        }

        .grid-cell {
            width: var(--cell-w); height: var(--cell-h); border-right: 1.2px solid #000; border-bottom: 1.2px solid #000;
        }

        .dashed-cell { background-image: radial-gradient(#bbb 1px, transparent 1px); background-size: 5px 5px; }
        .thick-bottom { border-bottom: 3.5px solid #000 !important; }

        .hint-col {
            display: flex; flex-direction: column; justify-content: space-around;
            font-size: 7pt; color: #555; padding-left: 3px; line-height: var(--cell-h); font-weight: bold;
        }

        .hidden { display: none !important; }
        .flex-row { display: flex; align-items: flex-start; padding-left: calc(var(--cell-w) * 0.7); }

        @media print {
            body { background: none; } .no-print { display: none; }
            .a4-page { margin: 0; box-shadow: none; padding: 5mm 8mm; height: 297mm; }
        }
    </style>
</head>
<body>

<div class="no-print">
    <button class="btn-mode" id="m_none" onclick="setMode('none')">ğŸŸ¢ ä¸é€²ä½</button>
    <button class="btn-mode" id="m_unit" onclick="setMode('unit')">ğŸ”µ å€‹é€²å</button>
    <button class="btn-mode" id="m_tens" onclick="setMode('tens')">ğŸŸ£ åé€²ç™¾</button>
    <button class="btn-mode" id="m_any" onclick="setMode('any')">ğŸ”´ éš¨æ©Ÿæ··å’Œ</button>
    <span style="color:white; margin:0 5px;">|</span>
    <button class="btn-layout" id="btn33" onclick="setLayout(3,3)">3x3 (9é¡Œ)</button>
    <button class="btn-layout" id="btn44" onclick="setLayout(4,4)">4x4 (16é¡Œ)</button>
    <button class="btn-layout" id="btn45" onclick="setLayout(4,5)">4x5 (20é¡Œ)</button>
    <span style="color:white; margin:0 5px;">|</span>
    <button class="btn-toggle" onclick="toggleHints()" id="toggleBtn">ğŸ’¡ éš±è—èªªæ˜</button>
</div>

<div class="a4-page">
    <div class="header"><h1 id="pageTitle">äºŒä½æ•¸ä¹˜æ³•ç·´ç¿’å·</h1></div>
    <div class="student-info">
        <div>ç­ç´šï¼š<span class="line"></span></div>
        <div>åº§è™Ÿï¼š<span class="line"></span></div>
        <div>å§“åï¼š<span class="line"></span></div>
    </div>
    <div id="quizContainer" class="quiz-container"></div>
</div>

<script>
    let currentMode = 'none';
    let showHints = true;
    let rows = 3, cols = 3;

    function setMode(m) {
        currentMode = m;
        document.querySelectorAll('.btn-mode').forEach(b => b.classList.remove('active'));
        document.getElementById(`m_${m}`).classList.add('active');
        generateProblems();
    }

    function setLayout(c, r) {
        cols = c; rows = r;
        document.querySelectorAll('.btn-layout').forEach(b => b.classList.remove('active'));
        document.getElementById(`btn${c}${r}`).classList.add('active');
        
        const root = document.documentElement;
        if (c === 3) { // 3x3
            root.style.setProperty('--cell-w', '45px'); root.style.setProperty('--cell-h', '50px');
            root.style.setProperty('--font-main', '28pt'); root.style.setProperty('--font-sign', '22pt');
            root.style.setProperty('--col-count', '3');
        } else if (r === 4) { // 4x4
            root.style.setProperty('--cell-w', '38px'); root.style.setProperty('--cell-h', '38px');
            root.style.setProperty('--font-main', '20pt'); root.style.setProperty('--font-sign', '16pt');
            root.style.setProperty('--col-count', '4');
        } else { // 4x5 åš´æ ¼ç¸®æ¸›é«˜åº¦ä»¥é˜²æº¢å‡º
            root.style.setProperty('--cell-w', '36px'); root.style.setProperty('--cell-h', '32px');
            root.style.setProperty('--font-main', '18pt'); root.style.setProperty('--font-sign', '14pt');
            root.style.setProperty('--col-count', '4');
        }
        generateProblems();
    }

    function toggleHints() {
        showHints = !showHints;
        document.getElementById('toggleBtn').innerText = showHints ? "ğŸ’¡ éš±è—èªªæ˜" : "ğŸŒ™ é¡¯ç¤ºèªªæ˜";
        generateProblems();
    }

    function generateProblems() {
        const container = document.getElementById('quizContainer');
        const title = document.getElementById('pageTitle');
        container.innerHTML = ''; 
        let mText = (currentMode==='none')?"(ä¸é€²ä½)":(currentMode==='unit')?"(å€‹ä½é€²åä½)":(currentMode==='tens')?"(åä½é€²ç™¾ä½)":"(éš¨æ©Ÿæ··å’Œ)";
        title.innerText = `äºŒä½æ•¸ä¹˜æ³•ç·´ç¿’å· ${mText}`;

        const total = rows * cols;
        for (let i = 0; i < total; i++) {
            let num1 = Math.floor(Math.random() * 88) + 11;
            let num2 = Math.floor(Math.random() * 8) + 2;
            let n1_10 = Math.floor(num1 / 10), n1_1 = num1 % 10;
            
            let isUnitCarry = (n1_1 * num2) >= 10;
            let isTensCarry = (n1_10 * num2) >= 10;
            let match = false;

            if (currentMode === 'none') match = !isUnitCarry && !isTensCarry;
            else if (currentMode === 'unit') match = isUnitCarry && !isTensCarry;
            else if (currentMode === 'tens') match = !isUnitCarry && isTensCarry;
            else match = true;

            if (!match) { i--; continue; }

            container.innerHTML += `
            <div class="math-problem">
                <div class="overall-layout">
                    <div class="problem-top">
                        <div class="top-sign"></div><div class="top-cell"></div><div class="top-cell">${n1_10}</div><div class="top-cell">${n1_1}</div>
                        <div class="top-sign">Ã—</div><div class="top-cell"></div><div class="top-cell"></div><div class="top-cell">${num2}</div>
                        <div class="underline"></div>
                    </div>
                    <div class="flex-row">
                        <div class="answer-grid">
                            <div class="grid-cell dashed-cell"></div><div class="grid-cell dashed-cell"></div><div class="grid-cell dashed-cell"></div>
                            <div class="grid-cell dashed-cell thick-bottom"></div><div class="grid-cell dashed-cell thick-bottom"></div><div class="grid-cell dashed-cell thick-bottom"></div>
                            <div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div>
                        </div>
                        <div class="hint-col ${showHints ? '' : 'hidden'}">
                            <div>(${n1_1}x${num2})</div><div>(${n1_10}0x${num2})</div><div>å’Œ</div>
                        </div>
                    </div>
                </div>
            </div>`;
        }
    }
    window.onload = () => { setLayout(3,3); setMode('none'); };
</script>
</body>
</html>
